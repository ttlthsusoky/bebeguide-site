(function initGrowthChart(){const form=document.getElementById('growthDataForm');const chartCanvas=document.getElementById('growthChart');const savedDataContainer=document.getElementById('savedGrowthData');const clearBtn=document.getElementById('clearGrowthData');const chartTabs=document.querySelectorAll('.chart-tab');if(!form || !chartCanvas)return;let currentChart=null;let currentChartType='height';const WHO_STANDARDS={height:{0: 49.9,1: 54.7,2: 58.4,3: 61.4,4: 63.9,5: 65.9,6: 67.6,7: 69.2,8: 70.6,9: 72.0,10: 73.3,11: 74.5,12: 75.7,18: 82.3,24: 87.1,30: 91.1,36: 95.1},weight:{0: 3.3,1: 4.5,2: 5.6,3: 6.4,4: 7.0,5: 7.5,6: 7.9,7: 8.3,8: 8.6,9: 8.9,10: 9.2,11: 9.4,12: 9.6,18: 11.3,24: 12.3,30: 13.2,36: 14.0}};function getGrowthData(){const data=localStorage.getItem('baby_growth_data');return data ? JSON.parse(data): [];}function saveGrowthData(data){localStorage.setItem('baby_growth_data',JSON.stringify(data));}function addGrowthRecord(month,height,weight){const data=getGrowthData();const record={id: Date.now(),month: parseInt(month),height: parseFloat(height),weight: parseFloat(weight),date: new Date().toLocaleDateString('ko-KR')};data.push(record);data.sort((a,b)=> a.month - b.month);saveGrowthData(data);return record;}function deleteGrowthRecord(id){let data=getGrowthData();data=data.filter(record=> record.id !==id);saveGrowthData(data);}function clearAllData(){if(confirm('ëª¨ë“  ì„±ì¥ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){localStorage.removeItem('baby_growth_data');updateSavedDataList();updateChart();showNotification('ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤','success');}}function updateSavedDataList(){const data=getGrowthData();const exportJSONBtn=document.getElementById('exportGrowthJSON');const exportCSVBtn=document.getElementById('exportGrowthCSV');const importLabel=document.querySelector('label[for="importGrowthJSON"]');if(data.length===0){savedDataContainer.innerHTML='<p class="no-data">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';clearBtn.style.display='none';if(exportJSONBtn)exportJSONBtn.style.display='none';if(exportCSVBtn)exportCSVBtn.style.display='none';if(importLabel)importLabel.style.display='inline-flex';return;}clearBtn.style.display='block';if(exportJSONBtn)exportJSONBtn.style.display='inline-flex';if(exportCSVBtn)exportCSVBtn.style.display='inline-flex';if(importLabel)importLabel.style.display='inline-flex';savedDataContainer.innerHTML=data.map(record=> `
<div class="growth-record-card">
<div class="record-header">
<span class="record-month">${record.month}ê°œì›”</span>
<button class="delete-record-btn" data-id="${record.id}" title="ì‚­ì œ">
<i class="fas fa-times"></i>
</button>
</div>
<div class="record-details">
<div class="record-item">
<i class="fas fa-ruler-vertical"></i>
<span>í‚¤: ${record.height}cm</span>
</div>
<div class="record-item">
<i class="fas fa-weight"></i>
<span>ëª¸ë¬´ê²Œ: ${record.weight}kg</span>
</div>
</div>
<div class="record-date">${record.date}ê¸°ë¡</div>
</div>
`).join('');document.querySelectorAll('.delete-record-btn').forEach(btn=>{btn.addEventListener('click',()=>{const id=parseInt(btn.getAttribute('data-id'));deleteGrowthRecord(id);updateSavedDataList();updateChart();showNotification('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤','success');});});}function updateChart(){const data=getGrowthData();if(currentChart){currentChart.destroy();}const months=data.map(d=> d.month);const values=data.map(d=> currentChartType==='height' ? d.height : d.weight);const allMonths=[0,1,2,3,4,5,6,7,8,9,10,11,12,18,24,30,36];const whoValues=allMonths.map(m=> WHO_STANDARDS[currentChartType][m]);const ctx=chartCanvas.getContext('2d');currentChart=new Chart(ctx,{type: 'line',data:{labels: allMonths,datasets: [{label: currentChartType==='height' ? 'ìš°ë¦¬ ì•„ê¸° í‚¤(cm)' : 'ìš°ë¦¬ ì•„ê¸° ëª¸ë¬´ê²Œ(kg)',data: allMonths.map(m=>{const record=data.find(d=> d.month===m);return record ?(currentChartType==='height' ? record.height : record.weight): null;}),borderColor: '#ff69b4',backgroundColor: 'rgba(255,105,180,0.1)',borderWidth: 3,pointRadius: 6,pointBackgroundColor: '#ff69b4',pointBorderColor: '#fff',pointBorderWidth: 2,tension: 0.4,fill: true},{label: 'WHO í‰ê·  ê¸°ì¤€',data: whoValues,borderColor: '#a8e6cf',backgroundColor: 'rgba(168,230,207,0.05)',borderWidth: 2,borderDash: [5,5],pointRadius: 0,tension: 0.4,fill: false}]},options:{responsive: true,maintainAspectRatio: true,interaction:{mode: 'index',intersect: false,},plugins:{legend:{display: true,position: 'top',},tooltip:{callbacks:{label: function(context){let label=context.dataset.label || '';if(label){label +=': ';}if(context.parsed.y !==null){label +=context.parsed.y +(currentChartType==='height' ? 'cm' : 'kg');}return label;}}}},scales:{x:{title:{display: true,text: 'ì›”ë ¹(ê°œì›”)',font:{size: 14,weight: 'bold'}},grid:{display: false}},y:{title:{display: true,text: currentChartType==='height' ? 'í‚¤(cm)' : 'ëª¸ë¬´ê²Œ(kg)',font:{size: 14,weight: 'bold'}},beginAtZero: false,grid:{color: 'rgba(0,0,0,0.05)'}}}}});}form.addEventListener('submit',(e)=>{e.preventDefault();const month=document.getElementById('growth_month').value;const height=document.getElementById('growth_height').value;const weight=document.getElementById('growth_weight').value;if(!month || !height || !weight){showNotification('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”','error');return;}addGrowthRecord(month,height,weight);updateSavedDataList();updateChart();form.reset();showNotification('ì„±ì¥ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“ˆ','success');});chartTabs.forEach(tab=>{tab.addEventListener('click',()=>{chartTabs.forEach(t=> t.classList.remove('active'));tab.classList.add('active');currentChartType=tab.getAttribute('data-chart');updateChart();});});clearBtn?.addEventListener('click',clearAllData);const exportJSONBtn=document.getElementById('exportGrowthJSON');const exportCSVBtn=document.getElementById('exportGrowthCSV');function downloadFile(content,filename,type){const blob=new Blob([content],{type: type});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);}function exportGrowthToJSON(){const data=getGrowthData();if(data.length===0){showNotification('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤','error');return;}const dataStr=JSON.stringify(data,null,2);const today=new Date().toISOString().split('T')[0];downloadFile(dataStr,`ë² ë² ê°€ì´ë“œ_ì„±ì¥ê¸°ë¡_${today}.json`,'application/json');showNotification('ì„±ì¥ ê¸°ë¡ì„ JSONìœ¼ë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤!','success');}function exportGrowthToCSV(){const data=getGrowthData();if(data.length===0){showNotification('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤','error');return;}let csv='ì›”ë ¹,í‚¤(cm),ëª¸ë¬´ê²Œ(kg),ê¸°ë¡ì¼\n';data.forEach(record=>{const row=[
record.month + 'ê°œì›”',record.height,record.weight,record.date
];csv +=row.join(',')+ '\n';});const BOM='\uFEFF';const today=new Date().toISOString().split('T')[0];downloadFile(BOM + csv,`ë² ë² ê°€ì´ë“œ_ì„±ì¥ê¸°ë¡_${today}.csv`,'text/csv;charset=utf-8');showNotification('ì„±ì¥ ê¸°ë¡ì„ CSVë¡œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤!','success');}exportJSONBtn?.addEventListener('click',exportGrowthToJSON);exportCSVBtn?.addEventListener('click',exportGrowthToCSV);const importJSONInput=document.getElementById('importGrowthJSON');function importGrowthFromJSON(file){const reader=new FileReader();reader.onload=(e)=>{try{const importedData=JSON.parse(e.target.result);if(!Array.isArray(importedData)){showNotification('ì˜¬ë°”ë¥¸ ì„±ì¥ ë°ì´í„° í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤','error');return;}const isValid=importedData.every(record=>
record.hasOwnProperty('month')&&
record.hasOwnProperty('height')&&
record.hasOwnProperty('weight'));if(!isValid){showNotification('ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤','error');return;}const existingData=getGrowthData();if(existingData.length > 0){if(!confirm('ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë³‘í•©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì·¨ì†Œí•˜ë©´ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì”ë‹ˆë‹¤)')){saveGrowthData(importedData);updateSavedDataList();updateChart();showNotification(`${importedData.length}ê°œì˜ ì„±ì¥ ê¸°ë¡ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤`,'success');return;}}const mergedData=[...existingData];let newCount=0;importedData.forEach(record=>{const exists=mergedData.find(e=>(e.id && record.id && e.id===record.id)||(e.month===record.month && e.height===record.height && e.weight===record.weight));if(!exists){if(!record.id)record.id=Date.now()+ newCount;mergedData.push(record);newCount++;}});mergedData.sort((a,b)=> a.month - b.month);saveGrowthData(mergedData);updateSavedDataList();updateChart();showNotification(`${newCount}ê°œì˜ ìƒˆë¡œìš´ ì„±ì¥ ê¸°ë¡ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤(ì´ ${mergedData.length}ê°œ)`,'success');}catch(error){showNotification('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤','error');console.error('Import error:',error);}};reader.readAsText(file);}importJSONInput?.addEventListener('change',(e)=>{const file=e.target.files[0];if(file){importGrowthFromJSON(file);e.target.value='';}});updateSavedDataList();updateChart();})();console.log("ğŸ¼ ë² ë² ê°€ì´ë“œ chart.js ë¡œë“œ ì™„ë£Œ");